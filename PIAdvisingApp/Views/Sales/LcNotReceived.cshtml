@model IEnumerable<PIAdvisingApp.ViewModels.PrcRptLcNotReceived>

@section Css {
    <link rel="stylesheet" href="https://cdn.datatables.net/1.10.21/css/dataTables.bootstrap4.min.css">
    <link href="https://unpkg.com/gijgo@1.9.13/css/gijgo.min.css" rel="stylesheet" type="text/css" />
    <link href="https://cdn.jsdelivr.net/npm/select2@4.0.13/dist/css/select2.min.css" rel="stylesheet" />
    <style>
        .tbody, td, th {
            padding: 2px !important;
            font-size: 11px !important;
        }
    </style>
}
<div class="app-page-title">
    <div class="page-title-wrapper">
        <div class="page-title-heading">
            <div>
                LC Not Received
            </div>
        </div>
    </div>
</div>

@*<div class="container">
        @using (Html.BeginForm("LcNotReceived", "Sales", FormMethod.Get))
        {
            <label for="fromDate">From Date:</label>
            @Html.TextBox("fromDate", null, new { type = "date" })

            <label for="toDate">To Date:</label>
            @Html.TextBox("toDate", null, new { type = "date" })

            <input type="submit" value="Submit" />
        }
    </div>*@

@*<div class="container-fluid">
        <div class="row">
            <div class="col-md-3 mb-3 mb-md-2">
                <div class="card w-100 bg-white p-3 my-2">

                    @using (Html.BeginForm("LcNotReceived", "Sales", FormMethod.Get))
                    {
                        <div class="form-group row">
                            <label for="fromDate" class="col-sm-4 col-form-label">From Date:</label>
                            <div class="col-sm-8">
                                @Html.TextBox("fromDate", null, new { type = "date", @class = "form-control" })
                            </div>
                        </div>

                        <div class="form-group row">
                            <label for="toDate" class="col-sm-4 col-form-label">To Date:</label>
                            <div class="col-sm-8">
                                @Html.TextBox("toDate", null, new { type = "date", @class = "form-control" })
                            </div>
                        </div>

                        <div class="form-group row">
                            <label for="customerName" class="col-sm-4 col-form-label">Customer Name:</label>
                            <div class="col-sm-8">
                                @Html.TextBox("customerName", null, new { @class = "form-control" })
                            </div>
                        </div>

                        <div class="form-group row">
                            <label for="retailerName" class="col-sm-4 col-form-label">Retailer Name:</label>
                            <div class="col-sm-8">
                                @Html.TextBox("retailerName", null, new { @class = "form-control" })
                            </div>
                        </div>

                        <div class="form-group row">
                            <label for="representativeName" class="col-sm-4 col-form-label">Representative Name:</label>
                            <div class="col-sm-8">
                                @Html.TextBox("representativeName", null, new { @class = "form-control" })
                            </div>
                        </div>

                        <div class="form-group row">
                            <div class="col-sm-12 text-center">
                                <input type="submit" value="Submit" class="btn btn-primary" />
                            </div>
                        </div>
                    }
                </div>
            </div>

        </div>
    </div>*@

<div class="container-fluid">
    <div class="row">
        <div class="col-md-12 mb-3 mb-md-2">
            <div class="card w-100 bg-white p-3 my-2">

                @using (Html.BeginForm("LcNotReceived", "Sales", FormMethod.Get))
                {
                    <div class="form-row">
                        <div class="form-group col-md-2">
                            <label for="fromDate" class="col-form-label">From Date:</label>
                            @Html.TextBox("fromDate", null, new { type = "date", @class = "form-control" })
                        </div>

                        <div class="form-group col-md-2">
                            <label for="toDate" class="col-form-label">To Date:</label>
                            @Html.TextBox("toDate", null, new { type = "date", @class = "form-control" })
                        </div>

                        <div class="form-group col-md-2">
                            <label for="customerName" class="col-form-label">Customer Name:</label>
                            @Html.TextBox("customerName", null, new { @class = "form-control" })
                        </div>

                        @*<div class="form-group col-md-2">
                            <label for="customerName" class="col-form-label">Customer Name:</label>
                            @Html.DropDownList("customerId", new SelectList(ViewBag.Customers, "CustomerId", "Name"), "Select a customer", new { @class = "form-control" })
                        </div>*@

                        <div class="form-group col-md-2">
                            <label for="retailerName" class="col-form-label">Retailer Name:</label>
                            @Html.TextBox("retailerName", null, new { @class = "form-control" })
                        </div>



                        <div class="form-group col-md-2">
                            <label for="representativeName" class="col-form-label">Representative Name:</label>
                            @Html.TextBox("representativeName", null, new { @class = "form-control" })
                        </div>

                        <div class="form-group col-md-2 align-self-end">
                            <input type="submit" value="Submit" class="btn btn-primary" />
                        </div>
                    </div>
                }
            </div>
        </div>
    </div>
</div>


<div class="row mb-5">
    <div class="col-12 mb-1 p-0">
        <div class="main-card mb-6 card">
            <div class="card-body">
                <table id="datatable" class="table table-striped table-bordered" style="width:100%">
                    <thead class="th-top">
                        @*<tr class="th-top">
                                <th class="text-center th-top" colspan="19">LC Not Received</th>
                            </tr>*@
                        <tr>
                            <th>SL</th>
                            <th class="text-center">Booking No</th>
                            <th class="text-center">Booking Date</th>
                            <th class="text-center">Representative Name</th>
                            <th class="text-center">Customer Name</th>
                            @*<th class="text-center">Customer Ref</th>*@
                            @*<th class="text-center">RNNo</th>*@
                            <th class="text-center">Booking Qty</th>
                            <th class="text-center">Booking Value</th>
                            @*<th class="text-center">Cancel Qty</th>
                                <th class="text-center">Cancel Value</th>*@
                            <th class="text-center">Invoice Qty</th>
                            <th class="text-center">Invoice Value</th>
                            <th class="text-center">LCrcv Value</th>
                            <th class="text-center">LC Balance</th>
                            <th class="text-center">PI Status</th>
                            <th class="text-center">Retailer Name</th>
                            <th class="text-center">Delivery (%)</th>
                            <th class="text-center">Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        @{ int rowNo = 1;}
                        @foreach (var item in Model)
                        {
                            <tr>
                                <td class="text-center td-green"><b>@rowNo</b></td>
                                <td class="text-center td-green">@item.BookingNo</td>
                                <td class="text-center td-green">@item.BookingDate.ToString("d-MMM-yyyy")</td>
                                <td class="text-center td-green">@item.RepresentativeName</td>
                                <td class="text-center td-green">@item.CustomerName</td>
                                <!--<td class="text-left td-green">@item.CustomerRef</td>-->
                                @*<td class="text-left td-green"></td>*@
                                <!--<td class="text-left td-green">@item.RNNo</td>-->

                                <td class="text-center td-green">@item.BookingQty</td>
                                @MyHelpers.FinancialNumberRoundedTd(item.BookingValue, "text-center td-green")
                                @*<td class="text-left td-green">@item.BookingValue</td>*@
                                @*<td class="text-left td-green">@item.CancelQty</td>
                                    @MyHelpers.FinancialNumberRoundedTd(item.CancelValue, "td-green")*@
                                <td class="text-center td-green">@item.InvoiceQty</td>
                                @MyHelpers.FinancialNumberRoundedTd(item.DelValue, "text-center td-green")
                                @MyHelpers.FinancialNumberRoundedTd(item.LCrcvValue, "text-center td-green")
                                @MyHelpers.FinancialNumberRoundedTd(item.LCBalance, "text-center td-green")
                                <td class="text-center td-green">@item.ISPISEND</td>
                                <td class="text-center td-green">@item.RetailerName</td>
                                @MyHelpers.FinancialNumberTd(item.DlvPer, "text-center td-pink", "", "%")
                                <td class="td-yellow"></td>
                            </tr>
                            rowNo++;
                        }

                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

@section Modal {
    <div class="modal fade salary-budget-forward-modal" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true" style="display: none;">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLongTitle">Forward Salary</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">×</span>
                    </button>
                </div>
                <div id="salary-budget-forward-modal-body" class="modal-body"></div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
}
@section Scripts {
    <script src="https://cdn.datatables.net/1.10.21/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.10.21/js/dataTables.bootstrap4.min.js"></script>
    <script src="https://unpkg.com/gijgo@1.9.13/js/gijgo.min.js" type="text/javascript"></script>
    <script src="https://cdn.jsdelivr.net/npm/select2@4.0.13/dist/js/select2.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@9"></script>
    <script>
        $(document).ready(function () {
            $('#datatable').DataTable();
            $('.select2').select2();
            $('#view-expense-head-btn').on('click', function () {
                var id = $('#cost_center_id').val();
                var url = 'SalaryEntry?costCenterId=' + id;
                $(location).attr("href", url);
            });
            $('#new-entry-btn').on('click', function () {
                var id = $('#cost_center_id').val();
                var url = 'SalaryEntryDetails?costCenterId=' + id;
                $(location).attr("href", url);
            });
            //changes for search
            var table = $('#datatable').DataTable({
                "lengthMenu": [[10, 25, 50, -1], [10, 25, 50, "All"]],
                "order": [[1, "desc"]]
            });

            // Add search functionality for Customer Name
            $('#customerName').on('keyup', function () {
                table.column(4).search(this.value).draw();
            });

            // Populate Customer Name dropdown
            $.getJSON("/Sales/GetCustomers", function (data) {
                $.each(data, function (key, value) {
                    $("#customerNameSelect").append("<option value='" + value.Id + "'>" + value.Name + "</option>");
                });
            });

            // Add search functionality for Customer Name
            $('#customerNameSelect').on('change', function () {
                var customerId = this.value;
                table.column(4).search(customerId).draw();
            });

            // Reset search when ALL is selected
            $('#customerNameSelect').on('focus', function () {
                $('#customerNameSelect').val('');
                table.column(4).search('').draw();
            });


            // Add search functionality for Representative Name
            $('#representativeName').on('keyup', function () {
                table.column(3).search(this.value).draw();
            });

              // Add search functionality for retailer Name
            $('#retailerName').on('keyup', function () {
                table.column(12).search(this.value).draw();
            });

            $('#see_more_btn').on('click', function () {
                var seeMoreAnchor = $(this).find('a');
                var hiddenRows = $('.hidden_rows').toArray();
                if (seeMoreAnchor.text() === 'See More') {
                    Swal.fire({
                        title: "Warning!",
                        text: "Are you sure? You want to add more expense head?",
                        type: "warning",
                        showCancelButton: true,
                        //useRejections: true,
                        confirmButtonText: "Add More",
                        cancelButtonText: "Cancel"
                    }).then(function (result) {
                        if (result.value) {
                            seeMoreAnchor.text('View Less');
                            $.each(hiddenRows, function (index, hiddenRow) {
                                if ($(hiddenRow).hasClass('d-none')) {
                                    $(hiddenRow).removeClass('d-none');
                                }
                            });
                        } else if (result.dismiss === 'cancel') {
                            //$(location).attr("href", '/purchases');
                        }
                    });
                } else {
                    $.each(hiddenRows, function (index, hiddenRow) {
                        $(hiddenRow).addClass('d-none');
                    });
                    seeMoreAnchor.text('See More');
                }
            });
            $('.approve-or-revise-btn').click(function () {
                var costCenterId = $(this).attr("data-costCenterId");
                var budgetYear = $(this).attr("data-budgetYear");
                var versionNo = $(this).attr("data-revisionNo");
                var budgetStatusId = $(this).attr("data-budgetStatusId");
                var comments = $(this).closest('tr').find('.comments').val();
                if (comments == "") {
                    Swal.fire(
                        'Warning!',
                        'Please enter a comment',
                        'error'
                    );
                    return;
                }
                $.post("@Url.Action("SaveOpexExpenseApproval", "Opex")", { costCenterId, budgetYear, versionNo, comments, budgetStatusId }, function (data) {
                    if (data) {
                        Swal.fire(
                            'Success!',
                            'Successfully Saved',
                            'success'
                        );
                        location.reload();
                    } else {
                        Swal.fire(
                            'Success!',
                            'Successfully Saved',
                            'success'
                        );
                    }
                });
            });
        });</script>
}
