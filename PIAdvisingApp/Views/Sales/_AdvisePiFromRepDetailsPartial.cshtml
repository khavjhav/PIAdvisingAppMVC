@model  IEnumerable<PIAdvisingApp.ViewModels.AdvisePiFromRepResult>


<style>
    /* Add CSS styles for sticky table headers */
    .table-responsive {
        overflow-x: auto;
    }

    .table-sticky-header thead th {
        position: sticky;
        top: 0;
        z-index: 1;
        background-color: #fff;
    }
</style>

<!-- Add the filter dropdowns -->
<div class="d-flex justify-content-between mb-3">
    <div class="form-group">
        <label for="product-type-filter">Product Type:</label>
        <select id="product-type-filter" class="form-control">
            <option value="">All</option>
            @foreach (var category in ViewBag.ProductTypes)
            {
                <option value="@category">@category</option>
            }
        </select>
    </div>
    <div class="form-group">
        <label for="retailer-filter">Retailer:</label>
        <select id="retailer-filter" class="form-control">
            <option value="">All</option>
            @foreach (var retailer in ViewBag.Retailers)
            {
                <option value="@retailer">@retailer</option>
            }
        </select>
    </div> 
    <div class="form-group">
        <label for="company-filter">Beneficiary:</label>
        <select id="company-filter" class="form-control">
            <option value="">All</option>
            @foreach (var company in ViewBag.CompanyNames)
            {
                <option value="@company">@company</option>
            }
        </select>
    </div>
    <div class="form-group">
        <label for="contact-filter">Contact Person:</label>
        <select id="contact-filter" class="form-control">
            <option value="">All</option>
            @foreach (var contact in ViewBag.ContactPersons)
            {
                <option value="@contact">@contact</option>
            }
        </select>
    </div>
</div>

<div class="main-card mb-1 card p-1">
    <div class="card-body p-1">
        <h5 class="card-title">Booking List</h5>
        <div class="table-responsive">
            <table id="booking-list-table" class="mb-0 table table-sm table-bordered table-sticky-header">
                <thead>
                    @{ int rowNo = 1;}
                    <tr>
                        <th class="text-center d-none">SL</th>
                        <th><input class="select-all m-2" type="checkbox" /></th>
                        <th class="text-center">Booking No</th>
                        <th class="text-center d-none">Booking Id</th>
                        <th class="text-center">Booking Date</th>
                        <th class="text-center">PI Status</th>
                        <th class="text-center d-none">Customer Name</th>
                        <th class="text-center d-none">Representative Name</th>
                        <th class="text-center d-none">Short Name</th>
                        <th class="text-center">Booking Qty</th>
                        <th class="text-center">Booking Value</th>
                        <th class="text-center">Retailer Name</th>
                        <th class="text-center">Contact Person</th>
                        <th class="text-center">Delivery (%)</th>
                        <th class="text-center">Category Name</th>
                        <th class="text-center">Company Name</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var item in Model)
                    {
                        <tr data-retailer-id="@item.RetailerId">
                            <td class="text-center d-none">@rowNo </td>
                            <td class="text-center"><input class="selected-item" type="checkbox" name="selectedItems" value="@item.BookingId" /></td>
                            <td class="text-center BookingNo">@item.BookingNo</td>
                            <td class="text-center BookingId  d-none">@item.BookingId</td>
                            <td class="text-center BookingDate">@item.BookingDate</td>
                            <td class="text-center PIStatus">@item.PIStatus</td>
                            <td class="text-center d-none CustomerName">@item.CustomerName</td>
                            <td class="text-center d-none RepresentativeName">@item.RepresentativeName</td>
                            <td class="text-center d-none ShortName">@item.ShortName</td>
                            <td class="text-center BookingQty">@item.BookingQty</td>
                            @MyHelpers.FinancialNumberRoundedTd(item.BookingValue, "td-green BookingValue")
                            <td class="text-center RetailerName">@item.RetailerName</td>
                            <td class="text-center ContactName">@item.ContactName</td>
                            <td class="text-center DeliveryPercentage">@item.DeliveryPercentage</td>
                            <td class="text-center CategoryName">@item.CategoryName</td>
                            <td class="text-center CompanyName">@item.CompanyName</td>
                        </tr>
                        rowNo++;
                    }
                </tbody>
            </table>
        </div>
    </div>
</div>


@*<script>

        // Move the DataTable initialization to the end of the script block
        $(document).ready(function () {
            // Initialize the DataTable
            var table = $('#booking-list-table').DataTable();

            // Filter event handler for product type
            $('#product-type-filter').on('change', function () {
                var categoryFilter = $(this).val();
                table.column(14).search(categoryFilter).draw();
            });

            // Filter event handler for retailer
            $('#retailer-filter').on('change', function () {
                var retailerFilter = $(this).val();
                table.column(12).search(retailerFilter).draw();
            });

            // Filter event handler for contact
            $('#contact-filter').on('change', function () {
                var contactFilter = $(this).val();
                table.column(13).search(contactFilter).draw();
            });

            // Filter event handler for company
            $('#company-filter').on('change', function () {
                var companyFilter = $(this).val();
                table.column(15).search(companyFilter).draw();
            });
        });

        $('.select-all').click(function () {
            if ($(this).is(':checked')) {
                $('.selected-item').prop('checked', true);
            } else {
                $('.selected-item').prop('checked', false);
            }
            //trigger selected-item onchange
            $('.selected-item').trigger('change');
        });


    </script>*@

<script>
    // Move the DataTable initialization to the end of the script block
    $(document).ready(function () {
        // Initialize the DataTable
        var table = $('#booking-list-table').DataTable();

        // Filter event handler for product type
        $('#product-type-filter').on('change', function () {
            var categoryFilter = $(this).val();
            console.log('Product Type Filter Value:', categoryFilter);
            table.column(14).search(categoryFilter).draw();
        });

        // Filter event handler for retailer
        $('#retailer-filter').on('change', function () {
            var retailerFilter = $(this).val();
            console.log('Retailer Filter Value:', retailerFilter);
            table.column(10).search(retailerFilter).draw();
        });
        //// Filter event handler for retailer
        //$('#retailer-filter').on('change', function () {
        //    var retailerFilter = $(this).val();
        //    console.log('Retailer Filter Value:', retailerFilter);
        //    table.column('Retailer Name:name').search(retailerFilter).draw();
        //});

        // Filter event handler for contact
        $('#contact-filter').on('change', function () {
            var contactFilter = $(this).val();
            console.log('Contact Filter Value:', contactFilter);
            table.column(12).search(contactFilter).draw();
        });

        // Filter event handler for company
        $('#company-filter').on('change', function () {
            var companyFilter = $(this).val();
            console.log('Company Filter Value:', companyFilter);
            table.column(15).search(companyFilter).draw();
        });
    });

    $('.select-all').click(function () {
        if ($(this).is(':checked')) {
            $('.selected-item').prop('checked', true);
        } else {
            $('.selected-item').prop('checked', false);
        }
        //trigger selected-item onchange
        $('.selected-item').trigger('change');
    });
</script>



